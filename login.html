<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nasir Login System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <style>
        /* CSS Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6c63ff;
            --primary-dark: #5a52d5;
            --secondary: #ff6584;
            --dark: #121212;
            --dark-light: #1e1e1e;
            --dark-lighter: #2d2d2d;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --success: #4caf50;
            --error: #f44336;
            --warning: #ff9800;
            --info: #2196f3;
            --border-radius: 12px;
            --transition: all 0.3s ease;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --glow: 0 0 20px rgba(108, 99, 255, 0.4);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0d0d0d 0%, #1a1a2e 50%, #16213e 100%);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            position: relative;
            overflow: hidden;
            line-height: 1.6;
        }

        /* Background Animation */
        .bg-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
        }

        .bg-circle {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
            opacity: 0.1;
            animation: float 15s infinite ease-in-out;
        }

        .bg-circle:nth-child(1) {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .bg-circle:nth-child(2) {
            width: 200px;
            height: 200px;
            top: 60%;
            left: 80%;
            animation-delay: 3s;
        }

        .bg-circle:nth-child(3) {
            width: 400px;
            height: 400px;
            top: 30%;
            left: 60%;
            animation-delay: 6s;
        }

        .bg-circle:nth-child(4) {
            width: 250px;
            height: 250px;
            top: 70%;
            left: 20%;
            animation-delay: 9s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) translateX(0);
            }
            25% {
                transform: translateY(-20px) translateX(10px);
            }
            50% {
                transform: translateY(10px) translateX(-10px);
            }
            75% {
                transform: translateY(-10px) translateX(-20px);
            }
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 10;
            background: rgba(30, 30, 46, 0.8);
            backdrop-filter: blur(10px);
            padding: 40px 35px;
            width: 100%;
            max-width: 450px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow), var(--glow);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), var(--glow);
        }

        /* Logo and Header */
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            background: var(--primary);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.4);
        }

        .logo-icon i {
            font-size: 24px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 14px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            color: var(--text-secondary);
            z-index: 2;
        }

        input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            background: var(--dark-lighter);
            border: 2px solid transparent;
            border-radius: var(--border-radius);
            color: var(--text);
            font-size: 16px;
            outline: none;
            transition: var(--transition);
        }

        input:focus {
            border-color: var(--primary);
            background: var(--dark-light);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }

        input::placeholder {
            color: var(--text-secondary);
        }

        /* Password Strength Meter */
        .password-strength {
            margin-top: 5px;
            height: 4px;
            border-radius: 2px;
            background: var(--dark-lighter);
            overflow: hidden;
            display: none;
        }

        .password-strength-meter {
            height: 100%;
            width: 0%;
            transition: var(--transition);
        }

        .password-strength.weak .password-strength-meter {
            background: var(--error);
            width: 33%;
        }

        .password-strength.medium .password-strength-meter {
            background: var(--warning);
            width: 66%;
        }

        .password-strength.strong .password-strength-meter {
            background: var(--success);
            width: 100%;
        }

        .password-requirements {
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
            display: none;
        }

        .password-requirements ul {
            padding-left: 20px;
            margin-top: 5px;
        }

        .password-requirements li {
            margin-bottom: 3px;
        }

        .requirement-met {
            color: var(--success);
        }

        .requirement-not-met {
            color: var(--error);
        }

        /* Password Toggle */
        .password-toggle {
            position: absolute;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
            z-index: 3;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .password-toggle:hover {
            color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
        }

        /* Button Styles */
        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            font-size: 16px;
            font-weight: 600;
            border-radius: var(--border-radius);
            cursor: pointer;
            color: white;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(108, 99, 255, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }

        .btn:hover::after {
            transform: translateX(100%);
            transition: transform 0.6s ease;
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* CAPTCHA Container */
        .captcha-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        /* Links and Additional Options */
        .links {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 14px;
        }

        .link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
        }

        .link:hover {
            color: var(--primary);
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 25px 0;
            color: var(--text-secondary);
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .divider span {
            padding: 0 15px;
            font-size: 14px;
        }

        /* Social Login */
        .social-login {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .social-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dark-lighter);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
        }

        .social-btn:hover {
            background: var(--dark-light);
            color: var(--primary);
            transform: translateY(-3px);
        }

        /* Success Box */
        .success-box {
            display: none;
            position: absolute;
            inset: 0;
            background: rgba(18, 18, 18, 0.95);
            border-radius: var(--border-radius);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            color: var(--success);
            animation: fadeIn 0.5s;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .success-box i {
            font-size: 60px;
            margin-bottom: 20px;
            animation: bounce 1s infinite alternate;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        /* Footer */
        .footer {
            margin-top: 30px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container {
                padding: 30px 25px;
                margin: 20px;
            }
            
            .logo-text {
                font-size: 20px;
            }
            
            .links {
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }
        }

        /* Loading Animation */
        .loading {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 18, 18, 0.8);
            border-radius: var(--border-radius);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(108, 99, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error Message Styles */
        .error-message {
            display: none;
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            font-size: 14px;
            text-align: left;
            animation: fadeIn 0.3s ease;
        }

        .error-message i {
            margin-right: 8px;
        }

        .success-message {
            display: none;
            background-color: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            font-size: 14px;
            text-align: left;
            animation: fadeIn 0.3s ease;
        }

        .success-message i {
            margin-right: 8px;
        }

        /* Security Features */
        .security-info {
            background: rgba(108, 99, 255, 0.1);
            border: 1px solid rgba(108, 99, 255, 0.3);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .security-info i {
            color: var(--primary);
            margin-right: 10px;
        }

        /* Two-Factor Container */
        .two-factor-container {
            display: none;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }

        .two-factor-code {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .two-factor-input {
            width: 45px;
            height: 55px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            background: var(--dark-lighter);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text);
            outline: none;
            transition: var(--transition);
        }

        .two-factor-input:focus {
            border-color: var(--primary);
            background: var(--dark-light);
            box-shadow: 0 0 0 2px rgba(108, 99, 255, 0.2);
        }

        /* Attempts Counter */
        .attempts-counter {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .attempts-counter.warning {
            color: var(--warning);
        }

        .attempts-counter.danger {
            color: var(--error);
        }

        /* Locked Message */
        .locked-message {
            display: none;
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            text-align: center;
        }

        /* Device Recognition */
        .device-recognition {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .device-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .device-icon {
            color: var(--primary);
            font-size: 18px;
        }

        .device-name {
            font-size: 14px;
        }

        .device-action {
            background: rgba(108, 99, 255, 0.1);
            border: 1px solid rgba(108, 99, 255, 0.3);
            color: var(--primary);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .device-action:hover {
            background: rgba(108, 99, 255, 0.2);
        }

        /* Session Timeout */
        .session-timeout {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(30, 30, 46, 0.95);
            border: 1px solid rgba(108, 99, 255, 0.4);
            border-radius: var(--border-radius);
            padding: 15px 20px;
            box-shadow: var(--shadow);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Password Match Check */
        .password-match {
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .password-match.match {
            color: var(--success);
        }

        .password-match.mismatch {
            color: var(--error);
        }

        /* Additional Security Options */
        .security-options {
            margin: 20px 0;
        }

        .security-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .security-option:hover {
            background: rgba(108, 99, 255, 0.1);
        }

        .security-option-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--dark-lighter);
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
</head>

<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
    </div>

    <!-- Session Timeout Warning -->
    <div class="session-timeout" id="sessionTimeout">
        <div style="font-weight: bold; color: var(--warning); margin-bottom: 5px;">
            <i class="fas fa-clock"></i> Session Expiring Soon
        </div>
        <div style="font-size: 13px;">Your session will expire in <span id="timeoutCountdown">5:00</span></div>
        <button onclick="extendSession()" style="margin-top: 10px; padding: 5px 15px; background: var(--primary); border: none; border-radius: 6px; color: white; cursor: pointer;">
            Extend Session
        </button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Success Box -->
        <div class="success-box" id="successBox">
            <i class="fas fa-check-circle"></i>
            <div>Login Successful!</div>
        </div>

        <!-- Loading Animation -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div id="loadingText">Authenticating...</div>
        </div>

        <!-- Logo and Header -->
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-lock"></i>
            </div>
            <div class="logo-text">Nasir Database</div>
        </div>
        
        <p class="subtitle">Sign in to access your secure dashboard</p>

        <!-- Security Information -->
        <div class="security-info">
            <i class="fas fa-shield-alt"></i>
            <span>Your security is our priority. All login attempts are monitored and protected.</span>
        </div>

        <!-- Login Form -->
        <div id="loginBox">
            <!-- Account Locked Message -->
            <div class="locked-message" id="lockedMessage">
                <i class="fas fa-lock"></i>
                <div style="font-weight: bold; margin-bottom: 5px;">Account Temporarily Locked</div>
                <div style="font-size: 13px;" id="lockTimeRemaining">Too many failed attempts. Please try again later.</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="loginEmail">Email Address</label>
                <div class="input-container">
                    <i class="fas fa-envelope input-icon"></i>
                    <input type="email" id="loginEmail" placeholder="Enter your email" autocomplete="email">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="loginPassword">Password</label>
                <div class="input-container">
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="loginPassword" placeholder="Enter your password" autocomplete="current-password">
                    <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                
                <!-- Password Strength Meter (for new passwords) -->
                <div class="password-strength" id="passwordStrength">
                    <div class="password-strength-meter"></div>
                </div>
                
                <!-- Attempts Counter -->
                <div class="attempts-counter" id="attemptsCounter">
                    <i class="fas fa-history"></i>
                    <span id="attemptsText">0 attempts remaining</span>
                </div>
                
                <!-- Error message container -->
                <div class="error-message" id="errorMessage">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="errorText"></span>
                </div>
                
                <!-- Success message container -->
                <div class="success-message" id="successMessage">
                    <i class="fas fa-check-circle"></i>
                    <span id="successText"></span>
                </div>
            </div>

            <!-- CAPTCHA -->
            <div class="captcha-container" id="captchaContainer">
                <div class="g-recaptcha" data-sitekey="6LcKZ_UpAAAAAE6mQm8t7zX6X6X6X6X6X6X6X6X6"></div>
            </div>

            <button type="button" class="btn" id="loginButton" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>

            <!-- Two-Factor Authentication -->
            <div class="two-factor-container" id="twoFactorContainer">
                <div style="text-align: center; margin-bottom: 15px;">
                    <i class="fas fa-mobile-alt" style="font-size: 30px; color: var(--primary); margin-bottom: 10px;"></i>
                    <div style="font-weight: bold; margin-bottom: 5px;">Two-Factor Authentication</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">Enter the 6-digit code from your authenticator app</div>
                </div>
                
                <div class="two-factor-code">
                    <input type="text" maxlength="1" class="two-factor-input" id="twoFactor1" onkeyup="moveToNext(this, 'twoFactor2')" pattern="[0-9]" inputmode="numeric">
                    <input type="text" maxlength="1" class="two-factor-input" id="twoFactor2" onkeyup="moveToNext(this, 'twoFactor3')" pattern="[0-9]" inputmode="numeric">
                    <input type="text" maxlength="1" class="two-factor-input" id="twoFactor3" onkeyup="moveToNext(this, 'twoFactor4')" pattern="[0-9]" inputmode="numeric">
                    <input type="text" maxlength="1" class="two-factor-input" id="twoFactor4" onkeyup="moveToNext(this, 'twoFactor5')" pattern="[0-9]" inputmode="numeric">
                    <input type="text" maxlength="1" class="two-factor-input" id="twoFactor5" onkeyup="moveToNext(this, 'twoFactor6')" pattern="[0-9]" inputmode="numeric">
                    <input type="text" maxlength="1" class="two-factor-input" id="twoFactor6" onkeyup="moveToNext(this, 'verifyTwoFactor')" pattern="[0-9]" inputmode="numeric">
                </div>
                
                <button type="button" class="btn" onclick="verifyTwoFactor()" style="margin-top: 15px;">
                    <i class="fas fa-check"></i> Verify Code
                </button>
                
                <div style="text-align: center; margin-top: 15px;">
                    <div class="link" onclick="resendTwoFactorCode()">
                        <i class="fas fa-redo"></i> Resend Code
                    </div>
                </div>
            </div>

            <!-- Device Recognition -->
            <div class="device-recognition" id="deviceRecognition" style="display: none;">
                <div class="device-info">
                    <i class="fas fa-desktop device-icon"></i>
                    <div class="device-name">New Device Detected</div>
                </div>
                <div class="device-action" onclick="trustThisDevice()">
                    Trust Device
                </div>
            </div>

            <div class="links">
                <div class="link" onclick="forgotPassword()">
                    <i class="fas fa-key"></i> Forgot Password?
                </div>
                <div class="link" onclick="goRegister()">
                    <i class="fas fa-user-plus"></i> Create Account
                </div>
            </div>

            <!-- Security Options -->
            <div class="security-options">
                <div class="security-option" onclick="toggleTwoFactor()">
                    <div class="security-option-label">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <div style="font-weight: 500;">Two-Factor Authentication</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Add extra security to your account</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="twoFactorToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <div class="security-option" onclick="toggleRememberDevice()">
                    <div class="security-option-label">
                        <i class="fas fa-desktop"></i>
                        <div>
                            <div style="font-weight: 500;">Remember This Device</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Skip CAPTCHA on this device</div>
                        </div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="rememberDeviceToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="divider">
                <span>Or continue with</span>
            </div>

            <div class="social-login">
                <div class="social-btn" onclick="socialLogin('google')">
                    <i class="fab fa-google"></i>
                </div>
                <div class="social-btn" onclick="socialLogin('facebook')">
                    <i class="fab fa-facebook-f"></i>
                </div>
                <div class="social-btn" onclick="socialLogin('twitter')">
                    <i class="fab fa-twitter"></i>
                </div>
            </div>
        </div>

        <div class="footer">
            <i class="fas fa-info-circle"></i> Last login: <span id="lastLoginTime">Never</span> | IP: <span id="currentIP">Loading...</span>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { 
        getAuth,
        sendPasswordResetEmail,
        signInWithEmailAndPassword,
        signInWithPopup,
        GoogleAuthProvider,
        FacebookAuthProvider,
        TwitterAuthProvider,
        sendEmailVerification,
        updateProfile,
        updatePassword,
        reauthenticateWithCredential,
        EmailAuthProvider
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import { getDatabase, ref, set, get, update, push, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCfLFgbq7m-pEK-jw-PQvwGh4zlyGE8n4w",
        authDomain: "nasir-48572.firebaseapp.com",
        databaseURL: "https://nasir-48572-default-rtdb.firebaseio.com",
        projectId: "nasir-48572",
        storageBucket: "nasir-48572.appspot.com",
        messagingSenderId: "1032758456576",
        appId: "1:1032758456576:web:eaea202eb1f313efc743e5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // Security Constants
    const MAX_LOGIN_ATTEMPTS = 5;
    const LOCK_DURATION = 15 * 60 * 1000; // 15 minutes in milliseconds
    const SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes
    const PASSWORD_MIN_LENGTH = 8;
    const PASSWORD_REQUIREMENTS = {
        length: PASSWORD_MIN_LENGTH,
        uppercase: true,
        lowercase: true,
        numbers: true,
        special: false
    };

    // Security Variables
    let loginAttempts = 0;
    let isAccountLocked = false;
    let lockUntil = 0;
    let sessionTimeoutTimer;
    let twoFactorEnabled = false;
    let trustedDevice = false;
    let userIP = '';
    let lastLoginData = null;

    // Initialize
    async function initializeSecurity() {
        // Get user IP
        await getUserIP();
        
        // Check if device is trusted
        checkTrustedDevice();
        
        // Setup session timeout warning
        setupSessionTimeout();
        
        // Load last login info
        loadLastLoginInfo();
    }

    // Function to show error message
    function showError(message, isSecurity = false) {
        console.log("Error:", message);
        const errorElement = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const successElement = document.getElementById('successMessage');
        
        // Hide success message if visible
        successElement.style.display = 'none';
        
        // Show error message
        errorText.textContent = message;
        errorElement.style.display = 'block';
        
        // Add security warning style
        if (isSecurity) {
            errorElement.style.borderColor = '#ff9800';
            errorElement.style.background = 'rgba(255, 152, 0, 0.1)';
        } else {
            errorElement.style.borderColor = '#f44336';
            errorElement.style.background = 'rgba(244, 67, 54, 0.1)';
        }
        
        // Update attempts counter
        updateAttemptsCounter();
    }

    // Function to show success message
    function showSuccess(message) {
        console.log("Success:", message);
        const successElement = document.getElementById('successMessage');
        const successText = document.getElementById('successText');
        const errorElement = document.getElementById('errorMessage');
        
        // Hide error message if visible
        errorElement.style.display = 'none';
        
        // Show success message
        successText.textContent = message;
        successElement.style.display = 'block';
    }

    // Function to hide all messages
    function hideMessages() {
        document.getElementById('errorMessage').style.display = 'none';
        document.getElementById('successMessage').style.display = 'none';
    }

    // Function to check for logout reason
    function checkLogoutReason() {
        const logoutReason = localStorage.getItem('logout_reason');
        if (logoutReason === 'session_ended_elsewhere') {
            showSuccess("You've been logged out because you logged in somewhere else. For security, only one active session is allowed.");
            localStorage.removeItem('logout_reason');
        }
    }

    // Get user IP address
    async function getUserIP() {
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            userIP = data.ip;
            document.getElementById('currentIP').textContent = userIP;
        } catch (error) {
            userIP = 'Unknown';
            document.getElementById('currentIP').textContent = 'Unknown';
        }
    }

    // Check if device is trusted
    function checkTrustedDevice() {
        const deviceToken = localStorage.getItem('trusted_device_token');
        const deviceEmail = localStorage.getItem('trusted_device_email');
        const currentEmail = document.getElementById('loginEmail').value;
        
        if (deviceToken && deviceEmail === currentEmail) {
            trustedDevice = true;
            document.getElementById('captchaContainer').style.display = 'none';
            document.getElementById('rememberDeviceToggle').checked = true;
        }
    }

    // Trust this device
    function trustThisDevice() {
        const email = document.getElementById('loginEmail').value;
        const deviceToken = Math.random().toString(36).substring(2) + Date.now().toString(36);
        
        localStorage.setItem('trusted_device_token', deviceToken);
        localStorage.setItem('trusted_device_email', email);
        localStorage.setItem('trusted_device_ip', userIP);
        localStorage.setItem('trusted_device_time', new Date().toISOString());
        
        trustedDevice = true;
        document.getElementById('deviceRecognition').style.display = 'none';
        document.getElementById('captchaContainer').style.display = 'none';
        
        showSuccess('This device is now trusted. CAPTCHA will be skipped for future logins.');
    }

    // Update attempts counter display
    function updateAttemptsCounter() {
        const attemptsRemaining = MAX_LOGIN_ATTEMPTS - loginAttempts;
        const attemptsCounter = document.getElementById('attemptsCounter');
        const attemptsText = document.getElementById('attemptsText');
        
        if (attemptsRemaining <= 0) {
            attemptsCounter.className = 'attempts-counter danger';
            attemptsText.textContent = 'Account locked';
            attemptsCounter.style.display = 'flex';
        } else if (attemptsRemaining <= 2) {
            attemptsCounter.className = 'attempts-counter warning';
            attemptsText.textContent = `${attemptsRemaining} attempts remaining`;
            attemptsCounter.style.display = 'flex';
        } else if (loginAttempts > 0) {
            attemptsCounter.className = 'attempts-counter';
            attemptsText.textContent = `${attemptsRemaining} attempts remaining`;
            attemptsCounter.style.display = 'flex';
        } else {
            attemptsCounter.style.display = 'none';
        }
    }

    // Check if account is locked
    function checkAccountLock(email) {
        const now = Date.now();
        const lockData = JSON.parse(localStorage.getItem(`lock_${email}`) || '{}');
        
        if (lockData.lockedUntil && now < lockData.lockedUntil) {
            isAccountLocked = true;
            lockUntil = lockData.lockedUntil;
            loginAttempts = lockData.attempts || 0;
            
            // Show locked message
            const lockedMessage = document.getElementById('lockedMessage');
            const lockTimeRemaining = document.getElementById('lockTimeRemaining');
            const minutesLeft = Math.ceil((lockUntil - now) / (60 * 1000));
            
            lockTimeRemaining.textContent = `Account locked for ${minutesLeft} more minute(s). Please try again later.`;
            lockedMessage.style.display = 'block';
            document.getElementById('loginButton').disabled = true;
            
            // Update lock timer
            updateLockTimer();
            return true;
        } else if (lockData.attempts) {
            loginAttempts = lockData.attempts;
            updateAttemptsCounter();
        }
        
        return false;
    }

    // Update lock timer display
    function updateLockTimer() {
        if (!isAccountLocked) return;
        
        const now = Date.now();
        const minutesLeft = Math.ceil((lockUntil - now) / (60 * 1000));
        
        if (minutesLeft <= 0) {
            // Lock expired
            isAccountLocked = false;
            loginAttempts = 0;
            document.getElementById('lockedMessage').style.display = 'none';
            document.getElementById('loginButton').disabled = false;
            
            const email = document.getElementById('loginEmail').value;
            localStorage.removeItem(`lock_${email}`);
            
            updateAttemptsCounter();
        } else {
            // Update display
            const lockTimeRemaining = document.getElementById('lockTimeRemaining');
            lockTimeRemaining.textContent = `Account locked for ${minutesLeft} more minute(s). Please try again later.`;
            
            // Check again in 1 minute
            setTimeout(updateLockTimer, 60000);
        }
    }

    // Lock account
    function lockAccount(email) {
        const now = Date.now();
        lockUntil = now + LOCK_DURATION;
        isAccountLocked = true;
        
        const lockData = {
            attempts: loginAttempts,
            lockedUntil: lockUntil,
            timestamp: new Date().toISOString(),
            ip: userIP
        };
        
        localStorage.setItem(`lock_${email}`, JSON.stringify(lockData));
        
        // Show locked message
        const lockedMessage = document.getElementById('lockedMessage');
        const lockTimeRemaining = document.getElementById('lockTimeRemaining');
        const minutesLeft = Math.ceil(LOCK_DURATION / (60 * 1000));
        
        lockTimeRemaining.textContent = `Account locked for ${minutesLeft} minutes. Please try again later.`;
        lockedMessage.style.display = 'block';
        document.getElementById('loginButton').disabled = true;
        
        // Start lock timer
        updateLockTimer();
        
        // Log security event
        logSecurityEvent(email, 'account_locked', {
            reason: 'too_many_attempts',
            attempts: loginAttempts,
            ip: userIP
        });
    }

    // Reset login attempts on successful login
    function resetLoginAttempts(email) {
        loginAttempts = 0;
        isAccountLocked = false;
        localStorage.removeItem(`lock_${email}`);
        updateAttemptsCounter();
    }

    // Increment login attempts
    function incrementLoginAttempts(email) {
        loginAttempts++;
        
        const attemptData = {
            attempts: loginAttempts,
            timestamp: new Date().toISOString(),
            ip: userIP
        };
        
        localStorage.setItem(`lock_${email}`, JSON.stringify(attemptData));
        
        // Log failed attempt
        logSecurityEvent(email, 'failed_login_attempt', {
            attempt: loginAttempts,
            ip: userIP
        });
        
        // Lock account if max attempts reached
        if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
            lockAccount(email);
        } else {
            updateAttemptsCounter();
        }
    }

    // Validate CAPTCHA
    function validateCaptcha() {
        if (trustedDevice) {
            console.log("Skipping CAPTCHA - trusted device");
            return true;
        }
        
        const response = grecaptcha.getResponse();
        if (response.length === 0) {
            showError("Please complete the CAPTCHA verification");
            return false;
        }
        
        // In production, you would verify with your server
        // For now, we'll accept any valid CAPTCHA response
        return true;
    }

    // Validate password strength
    function validatePasswordStrength(password) {
        const requirements = {
            length: password.length >= PASSWORD_MIN_LENGTH,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            numbers: /[0-9]/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };
        
        // Count met requirements
        const metRequirements = Object.values(requirements).filter(Boolean).length;
        const totalRequirements = Object.keys(requirements).length;
        
        return {
            valid: Object.values(requirements).every(req => req === true || !PASSWORD_REQUIREMENTS[Object.keys(requirements)[Object.values(requirements).indexOf(req)]]),
            strength: Math.round((metRequirements / totalRequirements) * 100),
            requirements: requirements
        };
    }

    // Setup session timeout
    function setupSessionTimeout() {
        // Clear any existing timer
        if (sessionTimeoutTimer) {
            clearTimeout(sessionTimeoutTimer);
        }
        
        // Set new timer for 25 minutes (5 minutes before actual timeout)
        sessionTimeoutTimer = setTimeout(() => {
            showSessionTimeoutWarning();
        }, 25 * 60 * 1000);
    }

    // Show session timeout warning
    function showSessionTimeoutWarning() {
        const timeoutElement = document.getElementById('sessionTimeout');
        let timeLeft = 300; // 5 minutes in seconds
        
        timeoutElement.style.display = 'block';
        
        const countdownInterval = setInterval(() => {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            
            document.getElementById('timeoutCountdown').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                timeoutElement.style.display = 'none';
                // Auto logout would happen here
            }
        }, 1000);
    }

    // Extend session
    function extendSession() {
        document.getElementById('sessionTimeout').style.display = 'none';
        setupSessionTimeout();
        showSuccess('Session extended for 30 minutes');
    }

    // Load last login info
    async function loadLastLoginInfo() {
        const lastLogin = localStorage.getItem('last_login');
        if (lastLogin) {
            const lastLoginDate = new Date(lastLogin);
            document.getElementById('lastLoginTime').textContent = 
                lastLoginDate.toLocaleDateString() + ' ' + lastLoginDate.toLocaleTimeString();
        }
    }

    // Log security event
    async function logSecurityEvent(email, eventType, details) {
        try {
            const eventRef = push(ref(database, 'securityLogs'));
            await set(eventRef, {
                email: email,
                type: eventType,
                details: details,
                timestamp: new Date().toISOString(),
                ip: userIP,
                userAgent: navigator.userAgent
            });
        } catch (error) {
            console.error('Error logging security event:', error);
        }
    }

    // Two-Factor Authentication functions
    function showTwoFactorAuth() {
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('twoFactorContainer').style.display = 'block';
        
        // Focus first input
        document.getElementById('twoFactor1').focus();
    }

    function hideTwoFactorAuth() {
        document.getElementById('twoFactorContainer').style.display = 'none';
        document.getElementById('loginBox').style.display = 'block';
    }

    function moveToNext(current, nextFieldId) {
        if (current.value.length === 1) {
            if (nextFieldId === 'verifyTwoFactor') {
                verifyTwoFactor();
            } else {
                document.getElementById(nextFieldId).focus();
            }
        }
    }

    async function verifyTwoFactor() {
        const code = 
            document.getElementById('twoFactor1').value +
            document.getElementById('twoFactor2').value +
            document.getElementById('twoFactor3').value +
            document.getElementById('twoFactor4').value +
            document.getElementById('twoFactor5').value +
            document.getElementById('twoFactor6').value;
        
        if (code.length !== 6) {
            showError('Please enter a valid 6-digit code');
            return;
        }
        
        // In production, verify with your 2FA backend
        // For demo, accept any 6-digit code starting with '1'
        if (code.startsWith('1')) {
            completeLogin();
        } else {
            showError('Invalid verification code');
            // Clear inputs
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`twoFactor${i}`).value = '';
            }
            document.getElementById('twoFactor1').focus();
        }
    }

    function resendTwoFactorCode() {
        showSuccess('New verification code sent to your email');
        // In production, send new code
    }

    function toggleTwoFactor() {
        twoFactorEnabled = !twoFactorEnabled;
        document.getElementById('twoFactorToggle').checked = twoFactorEnabled;
        
        if (twoFactorEnabled) {
            showSuccess('Two-factor authentication enabled. You will need to verify on next login.');
        } else {
            showSuccess('Two-factor authentication disabled.');
        }
    }

    function toggleRememberDevice() {
        const isChecked = document.getElementById('rememberDeviceToggle').checked;
        if (!isChecked) {
            // Remove trusted device
            localStorage.removeItem('trusted_device_token');
            localStorage.removeItem('trusted_device_email');
            localStorage.removeItem('trusted_device_ip');
            localStorage.removeItem('trusted_device_time');
            trustedDevice = false;
            document.getElementById('captchaContainer').style.display = 'block';
            showSuccess('This device will no longer be trusted.');
        }
    }

    // Social login
    async function socialLogin(providerName) {
        let provider;
        
        switch(providerName) {
            case 'google':
                provider = new GoogleAuthProvider();
                break;
            case 'facebook':
                provider = new FacebookAuthProvider();
                break;
            case 'twitter':
                provider = new TwitterAuthProvider();
                break;
            default:
                return;
        }
        
        try {
            const result = await signInWithPopup(auth, provider);
            showSuccess(`Logged in with ${providerName}`);
            setTimeout(() => {
                window.location.href = "https://nasir-hacker-database.vercel.app";
            }, 1500);
        } catch (error) {
            console.error('Social login error:', error);
            showError(`Failed to login with ${providerName}`);
        }
    }

    // Complete login process
    async function completeLogin() {
        const email = document.getElementById('loginEmail').value;
        
        // Reset login attempts
        resetLoginAttempts(email);
        
        // Log successful login
        localStorage.setItem('last_login', new Date().toISOString());
        await logSecurityEvent(email, 'successful_login', {
            ip: userIP,
            device: navigator.userAgent,
            timestamp: new Date().toISOString()
        });
        
        // Save login session
        const sessionRef = ref(database, `activeSessions/${auth.currentUser.uid}`);
        const newSessionId = Date.now().toString();
        
        await set(sessionRef, {
            sessionId: newSessionId,
            lastActive: new Date().toISOString(),
            userAgent: navigator.userAgent,
            email: email,
            ip: userIP
        });
        
        // Save to localStorage
        localStorage.setItem(`nasir_session_${auth.currentUser.uid}`, newSessionId);
        
        // Show success and redirect
        document.getElementById("loading").style.display = "none";
        document.getElementById("successBox").style.display = "flex";
        
        setTimeout(() => {
            window.location.href = "https://nasir-hacker-database.vercel.app";
        }, 1500);
    }

    // Make functions globally available
    window.togglePassword = function(id) {
        const field = document.getElementById(id);
        const icon = field.parentNode.querySelector('i');
        
        if (field.type === "password") {
            field.type = "text";
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            field.type = "password";
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    window.goRegister = function () {
        console.log("Redirecting to register page");
        window.location.href = "register.html";
    }

    window.forgotPassword = function () {
        window.location.href = "forget.html";
    }

    window.login = async function () {
        const email = document.getElementById("loginEmail").value.trim();
        const password = document.getElementById("loginPassword").value;
        
        console.log("Login attempt with:", email);
        
        // Hide any previous messages
        hideMessages();
        
        // Basic validation
        if (!email || !password) {
            showError("Please fill in all fields");
            return;
        }

        // Check if account is locked
        if (checkAccountLock(email)) {
            return;
        }

        // Validate CAPTCHA (if required)
        if (!trustedDevice && !validateCaptcha()) {
            return;
        }

        // Show loading animation
        document.getElementById("loading").style.display = "flex";
        document.getElementById("loadingText").textContent = "Verifying credentials...";

        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            
            // Check if email is verified
            if (!userCredential.user.emailVerified) {
                document.getElementById("loading").style.display = "none";
                showError("Please verify your email address before logging in. Check your inbox for verification email.");
                await auth.signOut();
                return;
            }
            
            // Reset attempts on successful login
            resetLoginAttempts(email);
            
            // Check for new device
            const lastKnownDevice = localStorage.getItem(`device_${email}`);
            const currentDevice = navigator.userAgent;
            
            if (lastKnownDevice && lastKnownDevice !== currentDevice) {
                document.getElementById("loading").style.display = "none";
                document.getElementById("deviceRecognition").style.display = 'flex';
                showSuccess("New device detected. You can trust this device for future logins.");
                return;
            }
            
            // Store device info
            localStorage.setItem(`device_${email}`, currentDevice);
            
            // Check if 2FA is enabled
            if (twoFactorEnabled) {
                document.getElementById("loading").style.display = "none";
                showTwoFactorAuth();
                return;
            }
            
            // Complete login
            await completeLogin();
            
        } catch (error) {
            // Always hide loading screen on error
            document.getElementById("loading").style.display = "none";
            console.error("Login error:", error);
            
            // Increment login attempts
            incrementLoginAttempts(email);
            
            // Convert Firebase errors to user-friendly messages
            let errorMessage = "Login failed. Please try again.";
            if (error.code === "auth/invalid-email") {
                errorMessage = "Invalid email address format.";
            } else if (error.code === "auth/user-not-found") {
                errorMessage = "Email not found. Please check your email address.";
            } else if (error.code === "auth/wrong-password") {
                errorMessage = "Incorrect password. Please try again.";
            } else if (error.code === "auth/too-many-requests") {
                errorMessage = "Too many failed attempts. Please try again later.";
            } else if (error.code === "auth/invalid-credential") {
                errorMessage = "Invalid credentials. Please check your email and password.";
            } else if (error.code === "auth/network-request-failed") {
                errorMessage = "Network error. Please check your internet connection.";
            } else if (error.code === "auth/user-disabled") {
                errorMessage = "This account has been disabled. Please contact support.";
            }
            
            showError(errorMessage);
            
            // Log failed login attempt
            await logSecurityEvent(email, 'failed_login', {
                error: error.code,
                ip: userIP,
                timestamp: new Date().toISOString()
            });
        }
    }

    // Additional global functions
    window.trustThisDevice = trustThisDevice;
    window.verifyTwoFactor = verifyTwoFactor;
    window.resendTwoFactorCode = resendTwoFactorCode;
    window.toggleTwoFactor = toggleTwoFactor;
    window.toggleRememberDevice = toggleRememberDevice;
    window.extendSession = extendSession;
    window.socialLogin = socialLogin;

    // Add event listeners for Enter key
    document.addEventListener('DOMContentLoaded', function() {
        initializeSecurity();
        checkLogoutReason();
        
        // Email input events
        document.getElementById('loginEmail').addEventListener('input', function() {
            checkAccountLock(this.value);
        });
        
        document.getElementById('loginEmail').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        // Password input events
        document.getElementById('loginPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        // Password strength indicator for registration link
        document.getElementById('loginPassword').addEventListener('input', function() {
            const strength = validatePasswordStrength(this.value);
            const strengthElement = document.getElementById('passwordStrength');
            
            if (this.value.length > 0) {
                strengthElement.style.display = 'block';
                strengthElement.className = 'password-strength';
                
                if (strength.strength < 40) {
                    strengthElement.classList.add('weak');
                } else if (strength.strength < 80) {
                    strengthElement.classList.add('medium');
                } else {
                    strengthElement.classList.add('strong');
                }
            } else {
                strengthElement.style.display = 'none';
            }
        });
        
        // Setup session timeout on page load
        setupSessionTimeout();
        
        // Auto-check for trusted device when email changes
        document.getElementById('loginEmail').addEventListener('change', function() {
            checkTrustedDevice();
        });
    });
</script>
</body>
</html>
